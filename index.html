<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0"/>
<meta http-equiv="Pragma" content="no-cache"/>
<meta http-equiv="Expires" content="0"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Marriage Connection Assessment — Individual</title>

<!-- ===========================================================
     CLEAN BUILD (v14-clean)
     - Fixes syntax errors, duplicates, and truncation
     - Category pickers with new intros + order (Core → Relational → Partnership)
     - Results header/subtitle/scripture/welcome text per spec
     - Genesis 2:24 moved under Section 1
     - Editable discussion prompts saved to localStorage
     - Thank You block + copyright footer
     =========================================================== -->

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500&family=Open+Sans:wght@600;700&family=Merriweather:ital,wght@1,400;1,700&family=Great+Vibes&display=swap" rel="stylesheet">

<style>
  body { font-family: Arial, sans-serif; background:#FFF9F2; color:#1A3C5E; max-width: 980px; margin:auto; padding:20px; box-sizing:border-box; }
  h1,h2,h3,h4{ text-align:center; line-height:1.25; }
  .card { background:#fff; border:2px solid #4D9DE0; border-radius:12px; padding:24px; box-shadow:0 8px 25px rgba(0,0,0,.08); margin: 20px auto; }
  .btn { background:#4D9DE0; color:#fff; font-weight:700; border:none; border-radius:8px; padding:12px 16px; cursor:pointer; margin:10px auto; display:block; width:100%; max-width:520px; }
  .btn:hover { background:#3A7FBF; }
  .hidden{ display:none; }

  .progress-bar-container{ width:100%; max-width:520px; height:10px; background:#E0E0E0; border-radius:5px; margin:8px auto 4px; }
  .progress-bar{ height:100%; background:#FF4D4D; border-radius:5px; transition:width .25s; }
  .muted{ color:#9aa3ab; text-align:center; margin-top:12px; font-size:12px; }
  .muted a{ color:#9aa3ab; text-decoration:none; }

  #introPage .intro-text { text-align:center; }
  #introPage .aha { font-style:italic; font-size:1.35rem; margin:0 0 8px 0; }

/* TOC card styling (brand-aligned) */
/* Guide styling (replaces .toc-card card) */
.toc-guide{
  border:none; box-shadow:none; padding:0;
  line-height:1.35;           /* ≥ 1.3 line spacing */
  margin:16px 0 16px 0;       /* spacing before and after */
}
.toc-guide .toc-title{
  margin:0 0 8px; color:#1A3C5E; font-family:'Open Sans',sans-serif;
}
.toc-guide .toc-list{ margin:0; padding-left:18px; }
.toc-guide .toc-item{ margin:12px 0; }
.toc-guide .toc-item > a{
  font-weight:700; text-decoration:none; color:#1A3C5E;
}
.toc-guide .toc-item > a:hover{ text-decoration:underline; }
.toc-guide .toc-note{
  margin:4px 0 6px; color:#4a607a;
}
.toc-guide .toc-sub{
  margin:4px 0 0; padding-left:18px; list-style:disc;
}
.toc-guide .toc-sub li{ margin:2px 0; }
.toc-guide .toc-sub a{ text-decoration:none; color:#1A3C5E; }
.toc-guide .toc-sub a:hover{ text-decoration:underline; }
.toc-guide .toc-sub span{ font-weight:600; color:#1A3C5E; margin-right:4px; }

@media print {
  #commHealthyPanel.hidden { display:block !important; }
}


/* Print polish */
@media print{
  #resultsTOC{ page-break-inside:avoid; }
}

.toc-card { border-color:#4D9DE0; }
.toc-title { margin:0 0 8px; color:#1A3C5E; font-family:'Open Sans',sans-serif; }
.toc-list { margin:0; padding-left:18px; }
.toc-item { margin:10px 0; }
.toc-item > a { font-weight:700; text-decoration:none; color:#1A3C5E; }
.toc-item > a:hover { text-decoration:underline; }
.toc-note { margin:2px 0 6px; color:#4a607a; font-size:.95rem; }

.toc-sub { margin:4px 0 0; padding-left:16px; list-style-type:disc; }
.toc-sub a { text-decoration:none; color:#1A3C5E; }
.toc-sub a:hover { text-decoration:underline; }
.toc-sub span { color:#4a607a; font-size:.92rem; margin-left:4px; }

/* Print: keep it compact but readable */
@media print {
  #resultsTOC { page-break-inside: avoid; }
  .toc-note, .toc-sub span { color:#333 !important; }
}

  .mini-grid { display:flex; flex-wrap:wrap; gap:10px; justify-content:center; }
  .mini-card { border:1px solid #4D9DE0; border-radius:8px; background:#fff; padding:10px 12px; max-width:360px; flex:1 1 280px; cursor:pointer; transition: box-shadow .15s, border-color .15s, background .15s; }
  .mini-card.selected { background: rgba(77,157,224,0.08); border-color:#3A7FBF; box-shadow: 0 0 0 2px rgba(58,127,191,0.20) inset; }
  .mini-title { font-weight:700; margin:0 0 6px 0; }
  .mini-desc  { font-size:.95rem; color:#4a607a; line-height:1.3; margin:0; }

  .answer-btn{ background:#fff; color:#1A3C5E; font-weight:400; font-size:1rem; border:1.5px solid #4D9DE0; border-radius:8px; padding:12px 14px; cursor:pointer; margin:8px auto; display:block; width:100%; max-width:520px; text-align:center; }
  .answer-btn:hover{ background:rgba(77,157,224,0.08); }
  .vertical-list{ display:flex; flex-direction:column; align-items:center; justify-content:flex-start; }

  .result-block { margin-bottom:16px; page-break-inside:avoid; padding:16px; border-left:8px solid #4D9DE0; border-radius:8px; background:#fff; line-height:1.35; }
  .section-title { color:#1A3C5E; font-family:'Open Sans',sans-serif; font-weight:700; font-size:18pt; margin-bottom:10px; }
  .subsection-title{
  color:#1A3C5E;
  font-family:'Roboto',sans-serif;
  font-weight:600;
  font-size:16pt;          /* was 14pt */
  line-height:1.25;
  margin:18px 0 6px;       /* a bit more breathing room */
  text-align:center;
}

  .subtitle-blue { text-align:center; font-style:italic; font-weight:400; color:#4D9DE0; margin:-2px 0 8px; font-size:16pt; font-family:'Merriweather', serif; }
  .section-divider{ height:1pt; background-color:#FF4D4D; width:100%; max-width:860px; margin:24pt auto; }
  .subsection-divider{ height:1pt; background-color:rgba(77,157,224,.5); width:100%; max-width:860px; margin:14pt auto; }

  .verse{ font-family:'Merriweather', serif; font-style:italic; color:#FF4D4D; text-align:center; margin:6px auto 10px; max-width:820px; font-size:11pt; }

  .intro-text{ margin:8px auto 12px; line-height:1.5; text-align:left; }

/* Results subtitle shown under "Your Connection Profile" */
.results-subtitle{
  text-align:center;
  font-family:'Merriweather', serif;
  font-style:italic;
  font-size:16px;      /* per your request */
  color:#1A3C5E;       /* per your request */
  margin:-4px 0 10px;  /* tucks it neatly under the H2 */
}


  /* Notebook-paper look for prompts (keeps the blue highlight) */
/* Notebook paper look (light blue tint + horizontal lines) */
.prompt-block{
  position:relative;
  border-left:none;
  border-radius:8px;
  margin:16px 0;
  padding:12px 16px;
  background-color: rgba(77,157,224,0.06); /* light blue tint */
  background-image:
    repeating-linear-gradient(
      to bottom,
      rgba(77,157,224,0.18) 0px,
      rgba(77,157,224,0.18) 1px,
      transparent 1px,
      transparent 26px
    );
  -webkit-print-color-adjust: exact;
  print-color-adjust: exact;
}

/* Seamless handwriting area on the paper */
.prompt-input{
  display:block;
  width:100%;
  min-height:300px;                 /* taller so it feels full-page */
  border:0 !important;              /* seamless edge */
  background:transparent !important;/* show paper lines behind */
  outline:0;
  padding:0;                        /* align text with the paper lines */
  margin:0;
  font:14px/1.7 'Merriweather',serif;
  color:#1A3C5E;
  resize:vertical;
  box-shadow:none;
}

.prompt-block .results-list{ margin-left:0; padding-left:18px; }
.prompt-block .results-list li{ margin-left:0; }


/* Title styling for 'Discussion Notes' */
/* Discussion Notes title – match couples */
.discussion-title{
  display:block;
  text-align:center;
  color:#4D9DE0;
  font-family:'Savoye LET','Zapfino','Great Vibes',cursive; /* same family as Thank You */
  font-size:2.6rem;  /* slightly larger */
  line-height:1.1;
  font-weight:400;
  margin:0 0 8px 0;
}


/* Keep the editable note area readable on the blue paper */
.prompt-input{
  width:100%;
  min-height:96px;
  background:transparent;       /* typed text shows the lines underneath */
  border:0; outline:0;
  padding:4px 4px 6px 0;
  font:14px/1.6 'Merriweather', serif;
  color:#1A3C5E;
}
.prompt-input:placeholder-shown{
  background-color: rgba(77,157,224,0.08); /* match the paper tint while empty */
  background-image:
    repeating-linear-gradient(
      to bottom,
      rgba(77,157,224,0.22) 0,
      rgba(77,157,224,0.22) 1px,
      transparent 1px,
      transparent 28px
    ),
    linear-gradient(
      to right,
      transparent 55px,
      rgba(220,60,60,0.75) 56px,
      transparent 57px
    );
  background-attachment: local, local;
  background-position: 0 0, 0 0;
  background-size: 100% 100%, 100% 100%;
}
.prompt-input::placeholder{ color:#7a8ba3; font-style:italic; }
.prompt-input:focus{ box-shadow: inset 0 -2px 0 rgba(77,157,224,.35); }


  .partner-header{ font-weight:700; text-align:center; margin-bottom:6px; }
  .results-list{ list-style-position:outside; margin-left:20px; text-align:left; }
 .results-list li{ margin-bottom:6px; }

/* Make Discussion Notes input transparent (always) */
.prompt-input{
  width:100%;
  min-height:96px;
  background:transparent !important;  /* no fill */
  border:0;
  outline:0;
  padding:4px 4px 6px 0;
  font:14px/1.6 'Merriweather', serif;
  color:#1A3C5E;
}

/* Keep placeholder readable without adding tint */
.prompt-input:placeholder-shown{
  background:transparent !important;
}

.prompt-input::placeholder{
  color:#7a8ba3;
  font-style:italic;
}

.prompt-input:focus{
  box-shadow: inset 0 -2px 0 rgba(77,157,224,.35);
}

.prompt-input::placeholder{
  color:#7a8ba3; font-style:italic;
}

.prompt-input:focus{
  box-shadow: inset 0 -2px 0 rgba(77,157,224,.35);
}

.prompt-input::placeholder{
  color:#7a8ba3; font-style:italic;
}
.prompt-input:focus{
  box-shadow: inset 0 -2px 0 rgba(77,157,224,.35);
}


  .prompt-input{ width:100%; min-height:84px; border:1px dashed #4D9DE0; border-radius:8px; padding:10px; margin-top:6px; resize:vertical; background:#fff; box-sizing:border-box; }

  /* Make framing questions look identical to subtitle-blue */
/* Match subheading look: centered, italic, light blue, Merriweather */
.subtitle-blue,
.framing-q{
  text-align:center !important;
  font-style:italic !important;
  font-weight:400;
  color:#4D9DE0 !important;
  font-size:14pt;
  font-family:'Merriweather', serif !important;
  margin:-2px 0 8px;
}



  .thank-title{ margin-top:0; margin-bottom:12pt; font-family:'Savoye LET','Zapfino','Great Vibes',cursive; color:#4D9DE0; font-size:4.4rem; line-height:1.1; text-align:center; }
  @media (max-width:700px){ .thank-title{ font-size:3.2rem; } }
  @media (max-width:420px){ .thank-title{ font-size:2.6rem; } }

  @media print { .btn { display:none !important; } .card { border:none; box-shadow:none; } body { background:#fff; } }
/* Actions row for results buttons */
.actions-row{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  justify-content:center;
  align-items:center;
  margin-top:8px;
}
/* Override the global .btn width so desktop can sit side-by-side */
/* Actions row for results buttons — UNIFORM SIZE & TYPOGRAPHY */
.actions-row{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  justify-content:center;
  align-items:center;
  margin-top:8px;
}

/* Make all three buttons identical on desktop */
.actions-row .btn{
  display:inline-flex;              /* same inline layout for <a> and <button> */
  align-items:center;
  justify-content:center;
  width:240px;                      /* equal width on desktop */
  padding:12px 16px;                /* same inner spacing */
  border-radius:8px;                /* same rounded corners */
  font-family:'Open Sans', sans-serif; /* same font */
  font-size:16px;                   /* same font size */
  font-weight:700;                  /* same weight */
  line-height:1.2;
  text-align:center;
  white-space:nowrap;               /* keep single line so heights match */
}

/* Ensure anchor buttons aren’t underlined */
.actions-row a.btn{ text-decoration:none; }

/* Mobile: stack full-width, still identical */
@media (max-width:700px){
  .actions-row{ flex-direction:column; }
  .actions-row .btn{ width:100%; max-width:520px; }
}
/* === RESULTS ACTION BUTTONS — FINAL OVERRIDES (moved out of <script>) === */
#resultPage .actions-row{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  justify-content:center;
  align-items:center;
  margin-top:8px;
}

#resultPage .actions-row .btn{
  display:inline-flex !important;
  align-items:center;
  justify-content:center;
  width:240px !important;
  max-width:none !important;
  padding:12px 16px !important;
  border-radius:8px !important;
  font-family:'Open Sans', sans-serif !important;
  font-size:16px !important;
  font-weight:700 !important;
  line-height:1.2 !important;
  text-decoration:none !important;
}

#resultPage .actions-row .btn:hover{ background:#3A7FBF; }

@media (max-width:700px){
  #resultPage .actions-row{ flex-direction:column; }
  #resultPage .actions-row .btn{
    width:100% !important;
    max-width:520px !important;
  }
}
/* Results card 'learn more' link — right-aligned, italic, not bold */
.result-block p.learn-more-wrap{
  text-align:right;
  margin:6px 0 0;
}
.result-block a.learn-more{
  color:#4D9DE0;
  font-weight:400;   /* not bold */
  font-style:italic; /* italic */
  text-decoration:none;
}
.result-block a.learn-more:hover{ text-decoration:underline; }



</style>
</head>
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('#resultsTOC a[href^="#"]').forEach(a=>{
    a.addEventListener('click', (e)=>{
      const target = document.querySelector(a.getAttribute('href'));
      if (target) { e.preventDefault(); target.scrollIntoView({ behavior:'smooth', block:'start' }); }
    });
  });
});
</script>


<body>
<!-- Intro Page -->
<div id="introPage" class="card">
  <a href="https://happymarriagehappylife.com" target="_blank" rel="noopener">
  <img src="https://static.wixstatic.com/media/4d6372_c110ccf05896482192f466d6c0e3c1ae~mv2.png" alt="Logo" style="display:block; margin:0 auto 12px; max-width:200px;" onerror="this.src='https://via.placeholder.com/200x80?text=Logo'">
</a>

  <h1>Your Guide to a Deeper Connection</h1>
  <div class="intro-text" style="text-align:center;">
    <p class="aha"><em>Ready for a few “aha!” moments?</em></p>
    <p>This <strong>questionnaire</strong> explores how you connect and what builds intimacy. After a few quick questions, you’ll get a personalized profile with simple, actionable ideas to help you build more intimacy in daily life.</p>
    <p style="margin-bottom:0.2em;"><strong>How it works</strong></p>
    <p style="margin:0;">Enter your name and go with your first honest answer—no overthinking needed.</p>
  </div>
  <div style="display:flex; gap:12px; justify-content:center; flex-wrap:wrap;">
    <input id="yourName" class="input" placeholder="Your name" aria-label="Your name" style="border:1px solid #4D9DE0; border-radius:8px; padding:10px 12px; min-width:260px; text-align:center;">
  </div>
  <div style="display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:10px;">
    <button id="startFreshBtn" class="btn" style="max-width:240px;">Start Assessment</button>
    <button id="resumeBtn" class="btn hidden" style="max-width:240px; background:#6A4C93;">Resume Saved Progress</button>
  </div>
  <p class="muted" title="The Covenant Intimacy Fulfillment Model™ (CIFM) is the original intellectual property of Dr. Scott Inman, PhD. It was developed through the research of Happy Marriage, Happy Life™ and the Comprehensive Covenant Marriage Model™ (CCMM). All rights reserved. Unauthorized reproduction or distribution is prohibited.">© 2025 Dr. Scott Inman, PhD. All rights reserved. CIFM™ is proprietary to Dr. Inman.</p>
</div>

<!-- Quiz Page -->
<div id="quizPage" class="card hidden">
  <h2 id="quizTitle">Assessment</h2>
  <div class="progress-bar-container"><div class="progress-bar" id="progressBar"></div></div>
  <div id="progress" style="text-align:center; margin-bottom:8px;"></div>

  <div id="questionContainer" class="question-box"></div>

  <!-- NEW: Back button -->
  <div style="display:flex; gap:10px; justify-content:center;">
    <button id="backBtn" class="btn" style="display:none; max-width:160px;">Back</button>
  </div>

  <p class="muted"><a href="https://happymarriagehappylife.com" target="_blank" rel="noopener">HappyMarriageHappyLife.com</a></p>
</div>


<!-- Results Page -->
<div id="resultPage" class="card hidden">
  <img src="https://static.wixstatic.com/media/4d6372_c110ccf05896482192f466d6c0e3c1ae~mv2.png" alt="Logo" style="display:block; margin:0 auto 12px; max-width:200px;" onerror="this.src='https://via.placeholder.com/200x80?text=Logo'">
  <h2 id="resultsHeader">Your Connection Profile</h2>
 <div class="subtitle-blue">Your Journey Begins</div>
  <div class="verse" id="topVerse"></div>
  <div id="resultsIntro" class="intro-text" style="text-align:left;"></div>

<!-- Table of Contents -->
<!-- Guide (formerly Table of Contents) -->
<div class="section-divider" id="tocDivider"></div>

<div class="toc-guide" id="resultsTOC">
  <h3 class="toc-title">Your Guide to Your Connection Profile</h3>
  <ol class="toc-list">
    <li class="toc-item">
      <a href="#s1">Section 1: The Core of Your Connection</a>
      <p class="toc-note">
        <strong>Your Personal Blueprint for Intimacy:</strong> What makes you feel truly connected?
        We'll look at your unique blend of emotional, physical, and partnership needs.
      </p>
      <ul class="toc-sub">
        <li><span>The Building Blocks:</span> Spiritual, commitment, and emotional anchors.</li>
        <li><span>The Teamwork Touch:</span> How you and your partner build and create together.</li>
        <li><span>The Daily Spark:</span> The everyday closeness that keeps the warmth alive.</li>
      </ul>
    </li>

    <li class="toc-item">
      <a href="#s2">Section 2: Navigating Relational Dynamics</a>
      <p class="toc-note">
        <strong>The Rhythms that Shape Your Relationship:</strong> Exploring the four key dynamics
        that influence how you and your partner connect day to day.
      </p>
      <ul class="toc-sub">
        <li><a href="#s2-care">Compassion &amp; Care</a>: Do you feel seen and cared for?</li>
        <li><a href="#s2-social">Social Preferences</a>: How do you both recharge?</li>
        <li><a href="#s2-power">Power &amp; Control</a>: Who gets to decide?</li>
        <li><a href="#s2-rr">Respect &amp; Recognition</a>: Do you feel truly valued?</li>
      </ul>
    </li>

    <li class="toc-item">
      <a href="#s3">Section 3: Mending &amp; Reconnecting</a>
      <p class="toc-note">Finding Your Way Back to Each Other: How you tend to repair and reconnect when things get tough.</p>
    </li>

    <li class="toc-item">
      <a href="#s4">Section 4: Your Voice in the Relationship</a>
      <p class="toc-note">Communicating Your Needs: Discover your primary communication style and a simple “try this” move to help you connect even better.</p>
    </li>

    <li class="toc-item">
      <a href="#thanks">Next Steps</a>
      <p class="toc-note">Ready to continue the journey?</p>
    </li>
  </ol>
</div>


  <div id="results"></div>
  <p class="muted">© 2025 Dr. Scott Inman, PhD. All rights reserved. CIFM™ is proprietary to Dr. Inman.</p>
</div>
<script>
const BUILD = "individual-v14-clean";

/* ---- Data & palettes ---- */
const INTIMACY = {
  Spiritual:{label:"Spiritual Intimacy", desc:"Spiritual intimacy is the shared sense of purpose and connection to God’s design that anchors a relationship. It’s the core that shapes how love is experienced and expressed, guiding your journey together."},
  Emotional:{label:"Emotional Intimacy", desc:"Emotional intimacy is the key to deep connection, creating a safe space for vulnerability and empathy. This crucial bond is the gateway that allows all other forms of closeness to flourish."},
  Commitment:{label:"Commitment Intimacy", desc:"Commitment intimacy is the security and dedication that acts as the core of a relationship, providing the stability needed to weather life’s storms. This dedicated bond is what allows a couple to face challenges and deepen their connection over time."},
  Intellectual:{label:"Intellectual Intimacy", desc:"Intellectual intimacy is about sharing a mental and emotional connection through engaging conversations and mutual respect for each other’s thoughts and values. It builds a powerful bond forged by the exchange of ideas and the exploration of new perspectives."},
  Affable:{label:"Affable Intimacy", desc:"Affable intimacy is the ease and comfort found in a relationship, creating a peaceful and enjoyable environment. It’s the simple joy of being agreeable and easygoing in your daily interactions with each other."},
  Conflict:{label:"Conflict Intimacy", desc:"Conflict intimacy is the ability to maintain a strong connection and mutual respect even during disagreements. It allows couples to navigate differences and grow closer through the process of resolving conflicts together."},
  Recreational:{label:"Recreational Intimacy", desc:"Recreational intimacy is about sharing laughter, playfulness, and joy through shared hobbies and experiences. It brings vitality and fun to a relationship, creating cherished memories that strengthen the bond."},
  Partnership:{label:"Partnership Intimacy", desc:"Partnership intimacy is the collaborative connection built by working together to manage daily responsibilities and make decisions. This forges a powerful bond as a couple functions as a unified team, tackling life’s challenges side by side."},
  Stability:{label:"Stability Intimacy", desc:"Stability intimacy is about transparently and honestly managing resources like time and money together, building a foundation of trust and a secure future. It’s a shared commitment to aligning your values as you work toward a common goal."},
  Creative:{label:"Creative Intimacy", desc:"Creative intimacy is the shared joy of bringing new ideas to life by building and dreaming together. This bond is strengthened through the process of collaborating on projects and seeing your shared vision become a reality."},
  Physical:{label:"Physical Intimacy", desc:"Physical intimacy involves connecting through non-sexual touch, comfort, and physical presence. This kind of closeness creates a sense of safety and security, affirming your bond through simple gestures and shared moments."},
  Sexual:{label:"Sexual Intimacy", desc:"Sexual intimacy is a passionate, exclusive, and sacred physical union that expresses a deep, committed connection. It’s a unique and powerful way to honor your bond through a shared experience of vulnerability and pleasure."}
};
const typeColors = { Spiritual:"#6A4C93", Emotional:"#FF7A70", Commitment:"#FFB347", Intellectual:"#4C6B9B", Affable:"#FFB6C1", Recreational:"#4DD2FF", Partnership:"#3CB371", Stability:"#FFD700", Creative:"#FF66CC", Conflict:"#FFA552", Physical:"#FF8C69", Sexual:"#E63946" };
const typeOpac   = { Spiritual:"rgba(106,76,147,.08)", Emotional:"rgba(255,122,112,.08)", Commitment:"rgba(255,179,71,.08)", Intellectual:"rgba(76,107,155,.08)", Affable:"rgba(255,182,193,.08)", Recreational:"rgba(77,210,255,.08)", Partnership:"rgba(60,179,113,.08)", Stability:"rgba(255,215,0,.08)", Creative:"rgba(255,102,204,.08)", Conflict:"rgba(255,165,82,.08)", Physical:"rgba(255,140,105,.08)", Sexual:"rgba(230,57,70,.08)" };

/* ---- Category sets + descriptions ---- */
const CORE_SET   = ["Spiritual","Emotional","Commitment","Stability"];
const RELATE_SET = ["Recreational","Affable","Physical","Sexual"];
const COLLAB_SET = ["Partnership","Intellectual","Creative","Conflict"];

const CORE_DESC = `Imagine your relationship as a house. Core Connections are the solid foundation that keeps everything steady, no matter what storms come your way. These are the deep, grounding elements that give your relationship its strength and purpose. As you read through these, picture which ones feel like the bedrock of your connection—the ones that make you feel secure and whole.<em></em>`;
const RELATE_DESC = `Now, let’s think of your relationship as a vibrant dance. Relational Connections are the moments that make your heart race, bringing joy, warmth, and closeness through shared experiences. These are the interactions that make your time together feel alive. As you explore these, imagine which ones light up your days and make you feel closest to your partner.<br><em></em>`;
const PARTNER_DESC = `Finally, imagine your relationship as a tandem bike ride, where you’re pedaling together toward a shared destination. Partnership Connections are about working as a team, tackling challenges, and building something meaningful side by side. These are the moments where you feel like true partners. As you read these, think about which ones make you feel like you’re unstoppable together.<br><em></em>`;

/* ---- Question card copy ---- */
const CORE_QDEF = { Spiritual:  "A shared sense of purpose and a deeper connection to God's design that anchors your relationship and guides your journey together.", Emotional:  "The ability to be vulnerable and share your deepest feelings and fears without judgment.", Commitment: "The security and dedication that provides stability and the promise to weather storms together.", Stability:  "Transparently and honestly managing resources together, building a foundation of trust for a secure future." };
const RELATE_QDEF = { Recreational:  "Sharing laughter, playfulness, and joy through shared hobbies and experiences.", Affable:  "The ease and comfort found in a relationship, creating a peaceful and enjoyable environment.", Physical: "Connecting through non-sexual touch, comfort, and physical presence.", Sexual: "A passionate, exclusive, and sacred physical union that expresses a deep, committed connection." };
const COLLAB_QDEF = { Partnership: "The collaborative connection built by working together to manage daily responsibilities.", Intellectual: "A shared mental connection through engaging conversations and mutual respect for each other’s thoughts.", Creative: "The shared joy of bringing new ideas to life by building and dreaming together.", Conflict: "The ability to maintain a strong connection and mutual respect even during disagreements." };

/* ---- State ---- */
const STORAGE_KEY = "mca_individual_state_v1";
let yourName = "";
const TOTAL_STEPS = 16; // 0..15
let step = 0;
const DEFAULT_ANSWERS = { coreTop2: [], relateTop2: [], collabTop2: [], expressedTop2: [], desiredTop2: [], social: {}, decision: {}, rr: { rr1:null, rr2:null }, bond: {}, notes: {} };
let answers = JSON.parse(JSON.stringify(DEFAULT_ANSWERS));

function ensureDefaults(){
  if (!answers || typeof answers !== 'object') answers = JSON.parse(JSON.stringify(DEFAULT_ANSWERS));
  ["coreTop2","relateTop2","collabTop2","expressedTop2","desiredTop2"].forEach(k=>{ if(!Array.isArray(answers[k])) answers[k] = []; });
  if (!answers.social || typeof answers.social !== 'object') answers.social = {};
  if (!answers.decision || typeof answers.decision !== 'object') answers.decision = {};
  if (!answers.rr || typeof answers.rr !== 'object') answers.rr = { rr1:null, rr2:null };
  if (!answers.bond || typeof answers.bond !== 'object') answers.bond = {};
  if (!answers.notes || typeof answers.notes !== 'object') answers.notes = {};
  if (!Number.isInteger(step) || step < 0 || step >= TOTAL_STEPS) step = 0;
}
function saveState(){ ensureDefaults(); try { localStorage.setItem(STORAGE_KEY, JSON.stringify({ yourName, step, answers })); } catch(e){} }
function loadState(){ try { const raw = localStorage.getItem(STORAGE_KEY); if(!raw) return false; const s = JSON.parse(raw); if(s && typeof s === 'object'){ yourName = s.yourName || yourName; step = Number.isInteger(s.step) ? s.step : step; answers = s.answers || answers; ensureDefaults(); return true; } return false; } catch(e){ return false; } }
function clearState(){ try { localStorage.removeItem(STORAGE_KEY); } catch(e){} }

/* ---- Launch ---- */
document.addEventListener('DOMContentLoaded', () => {
  const startBtn = document.getElementById('startFreshBtn');
  const resumeBtn = document.getElementById('resumeBtn');
  const backBtn  = document.getElementById('backBtn');

  if (localStorage.getItem(STORAGE_KEY)) {
    resumeBtn?.classList.remove('hidden');
  }

  // Back button
  backBtn?.addEventListener('click', () => {
    if (step > 0) {
      step--;
      saveState();
      renderStep();
    }
  });

  // Start fresh
  startBtn?.addEventListener('click', () => {
    try {
      clearState();
      yourName = (document.getElementById('yourName')?.value || "").trim() || "You";
      step = 0;
      answers = JSON.parse(JSON.stringify(DEFAULT_ANSWERS));
      saveState();
      showQuiz();
    } catch(e){
      alert('Oops — please reload the page.');
    }
  });

  // Resume
  resumeBtn?.addEventListener('click', () => {
    try {
      const restored = loadState();
      const typed = (document.getElementById('yourName')?.value || "").trim();
      if (typed) yourName = typed;
      ensureDefaults();
      if (!restored) step = 0;
      showQuiz();
    } catch(e){
      alert("Couldn’t resume. Starting fresh.");
      clearState();
      step = 0;
      answers = JSON.parse(JSON.stringify(DEFAULT_ANSWERS));
      showQuiz();
    }
  });
});


function showQuiz(){ hideAllPages(); document.getElementById('quizPage').classList.remove('hidden'); document.getElementById('quizTitle').textContent = `Assessment — ${yourName}`; renderStep(); }
function hideAllPages(){ document.getElementById('introPage').classList.add('hidden'); document.getElementById('quizPage').classList.add('hidden'); document.getElementById('resultPage').classList.add('hidden'); }

/* ---- Questionnaire renderer ---- */
function renderStep(){
  ensureDefaults();

  // NEW: toggle Back visibility
  const backBtn = document.getElementById('backBtn');
  if (backBtn) backBtn.style.display = step > 0 ? 'block' : 'none';


  const progEl = document.getElementById('progress');
  const barEl  = document.getElementById('progressBar');
  if (progEl) progEl.textContent = `Step ${step+1} of ${TOTAL_STEPS}`;
  if (barEl)  barEl.style.width   = `${((step+1)/TOTAL_STEPS)*100}%`;
  const box = document.getElementById('questionContainer'); box.innerHTML = "";

  if(step===0) return renderCategoryPick(box, "Core Connections: The Foundation of Your Relationship", CORE_DESC, CORE_SET, CORE_QDEF, 'coreTop2');
  if(step===1) return renderCategoryPick(box, "Relational Connections: The Heartbeat of Your Relationship", RELATE_DESC, RELATE_SET, RELATE_QDEF, 'relateTop2');
  if(step===2) return renderCategoryPick(box, "Partnership Connections: The Teamwork of Your Relationship", PARTNER_DESC, COLLAB_SET, COLLAB_QDEF, 'collabTop2');

  const codeToAffKey = (code)=>({ E:"Sanguine", S:"Choleric", R:"Melancholy", A:"Phlegmatic", U:"Supine" }[code]);
  const SANG="E", CHOL="S", MEL="R", PHLE="A", SUPI="U";

  if(step===3) return renderSingleList(box, "When it comes to showing affection in close relationships, I naturally…", [[SANG,"…initiate hugs, kisses, and warm words often; I easily express closeness."],[CHOL,"…show care through purposeful actions or brief gestures, less through emotional displays."],[MEL,"…reserve affection for a few, preferring deep talks or thoughtful acts over frequent touch."],[SUPI,"…hesitate to initiate affection, but show loyalty and care by being present and supportive."],[PHLE,"…offer steady, quiet companionship, showing affection in calm, consistent ways."]], val => { const k = codeToAffKey(val); answers.expressedTop2 = k ? [k] : []; saveState(); next(); });
  if(step===4) return renderSingleList(box, "To feel most loved and secure, I need my partner to…", [[SANG,"…frequently affirm me with words, touch, and celebratory gestures."],[CHOL,"…respect my independence, affirming my efforts more than giving constant affection."],[MEL,"…share deep emotional connection and understanding, not constant gestures."],[SUPI,"…initiate affection often so I feel needed and cherished without asking."],[PHLE,"…be present and kind in simple, low-pressure ways that make me feel secure."]], val => { const k = codeToAffKey(val); const arr = answers.desiredTop2 || []; if(k && !arr.includes(k) && arr.length<2) arr.push(k); answers.desiredTop2 = arr; saveState(); next(); });
  if(step===5) return renderSingleList(box, "Day to day, I feel most cared for when my partner…", [[SANG,"…keeps closeness fun and frequent with lighthearted affection."],[CHOL,"…takes initiative to solve problems or reduce stress for me."],[MEL,"…creates space for thoughtful talks and meaningful moments."],[SUPI,"…shows unprompted affection so I feel pursued and valued."],[PHLE,"…offers steady, dependable support without pressure."]], val => { const k = codeToAffKey(val); const arr = answers.desiredTop2 || []; if(k && !arr.includes(k) && arr.length<2) arr.push(k); answers.desiredTop2 = arr; saveState(); next(); });

  if(step===6) return renderSingleList(box, "In social settings, I usually…", [["E","…start conversations and draw people in, enjoying being at the center."],["S","…organize or lead the group toward a goal."],["R","…engage selectively, often preferring one-on-one over big groups."],["U","…help quietly, waiting for others to invite me in."],["A","…go with the flow, joining calmly without pushing for attention."]], val => { answers.social["social1"]=val; saveState(); next(); });
  if(step===7) return renderSingleList(box, "I feel most comfortable in groups when…", [["E","…I’m surrounded by people and actively invited to join the fun."],["S","…there’s a clear purpose or project, not just chatter."],["R","…the group is small, familiar, or low-key."],["U","…others seek me out and make me feel included."],["A","…the setting is relaxed and pressure-free."]], val => { answers.social["social2"]=val; saveState(); next(); });

  if(step===8) return renderSingleList(box, "When decisions need to be made, I usually…", [["S","…step up confidently and set direction for others."],["E","…help decide with energy and optimism, inviting collaboration."],["R","…prefer to manage my own responsibilities, not others’."],["U","…defer to others, supporting instead of leading."],["A","…stay flexible, only stepping in if needed to keep peace."]], val => { answers.decision["decision1"]=val; saveState(); next(); });
  if(step===9) return renderSingleList(box, "When others influence decisions that affect me, I prefer…", [["S","…to have the final say and resist being directed."],["E","…to collaborate and welcome positive input."],["R","…to be left to my own autonomy and self-direction."],["U","…to feel secure when others take the lead and guide me."],["A","…gentle guidance that keeps harmony without conflict."]], val => { answers.decision["decision2"]=val; saveState(); next(); });

  if(step===10) return renderSingleList(box, "I feel my opinions are respected in our relationship.", [[3,"Strongly Agree"],[2,"Agree"],[1,"Disagree"],[0,"Strongly Disagree"]], val => { answers.rr.rr1 = Number(val); saveState(); next(); });
  if(step===11) return renderSingleList(box, "We are aligned on core values and honor our covenant.", [[3,"Strongly Agree"],[2,"Agree"],[1,"Disagree"],[0,"Strongly Disagree"]], val => { answers.rr.rr2 = Number(val); saveState(); next(); });

  if(step===12) return renderSingleList(box, "During conflict, I naturally…", [["SteadyConnector","Look for a steady, low-tension path forward."],["ReassuranceSeeker","Seek quick clarity and closeness right away."],["IndependentConnector","Take a brief step back to collect my thoughts."],["GuardedConnector","Share less until I feel fully safe to open up."]], val => { answers.bond["bond1"]=val; saveState(); next(); });
  if(step===13) return renderSingleList(box, "When I feel unappreciated, I tend to…", [["SteadyConnector","Keep things even and move forward steadily."],["ReassuranceSeeker","Ask for clear acknowledgment or reassurance."],["IndependentConnector","Pull back to reset and think it through."],["GuardedConnector","Go quiet and wait before sharing more."]], val => { answers.bond["bond2"]=val; saveState(); next(); });
  if(step===14) return renderSingleList(box, "After a disagreement, I prefer to…", [["SteadyConnector","Reconnect calmly with a simple next step together."],["ReassuranceSeeker","Repair together soon and name what’s okay between us."],["IndependentConnector","Pause briefly, then return at a set time to resolve."],["GuardedConnector","Start small—share a little, then build from there."]], val => { answers.bond["bond3"]=val; saveState(); next(); });
  if(step===15) return renderSingleList(box, "When I’m overwhelmed, I prefer to…", [["SteadyConnector","Keep routines steady and talk when emotions settle."],["ReassuranceSeeker","Get reassurance and closeness before moving on."],["IndependentConnector","Take protected space, then reconnect as planned."],["GuardedConnector","Ease in gradually and share once trust feels solid."]], val => { answers.bond["bond4"]=val; saveState(); finalize(); });
}
function next(){ step++; renderStep(); }

function renderCategoryPick(root, title, desc, keys, defs, field){
  ensureDefaults();
  const picked = new Set(answers[field] || []);
  root.innerHTML = `
    <h3 style="text-align:center;">${title}</h3>
    <div class="intro-text" style="text-align:left; max-width:860px; margin:8px auto 8px;">${desc}</div>
    <p class="rank-help" style="text-align:center; margin-top:6px; color:#4a607a;"><em>Select your top 2. Selected: ${picked.size} / 2</em></p>
    <div class="mini-grid" id="miniGrid"></div>`;
  const grid = root.querySelector('#miniGrid');
  keys.forEach(k=>{
    const card = document.createElement('div');
    card.className = 'mini-card' + (picked.has(k) ? ' selected' : '');
    card.style.borderLeft = `6px solid ${typeColors[k]}`;
    card.style.paddingLeft = '10px';
    const label = INTIMACY[k].label.replace(/Intimacy/gi, 'Connection');
    const descTxt  = defs[k] || INTIMACY[k].desc.replace(/intimacy/gi,'connection');
    card.innerHTML = `<div class="mini-title">${label}</div><p class="mini-desc">${descTxt}</p>`;
    card.onclick = ()=>{ if(picked.has(k)) picked.delete(k); else if(picked.size<2) picked.add(k); answers[field] = [...picked]; saveState(); (picked.size===2) ? setTimeout(()=>next(),120) : renderCategoryPick(root, title, desc, keys, defs, field); };
    grid.appendChild(card);
  });
}

function renderSingleList(root, title, options, onPick){
  const showHelper = (typeof step === 'number' && step >= 3); // steps 3..15 == Sections 4..16
  const helperHTML = showHelper
    ? `<p style="text-align:center; margin-top:-6px; color:#4a607a;"><em>Select the one statement that best describes you.</em></p>`
    : "";

  root.innerHTML = `
    <h3 style="text-align:center;">${title}</h3>
    ${helperHTML}
    <div class="vertical-list"></div>
  `;
  const v = root.querySelector('.vertical-list');
  options.forEach(([val, txt])=>{
    const b = document.createElement('button');
    b.className = 'answer-btn';
    b.textContent = txt;
    b.onclick = ()=> onPick(val);
    v.appendChild(b);
  });
}


/* ---- Teaching data ---- */
const APS_CARE = {
  E: { express:`Expressing Love: You're a natural at bringing joy and playfulness into a relationship. Your affection is lighthearted, and you show you care by creating fun moments and lifting the mood. Your actions say, "I'm with you, and life is simply better because we're together."`, feel:`Feeling Most Loved: You feel most cherished when the love you give is returned with the same energy and enthusiasm. Laughter, consistent closeness, and affirmation make you feel truly adored and seen.`, cautions:`Cautions: Your strong need for fun and validation can sometimes feel overwhelming for a partner with a quieter temperament. If you don't feel like your energy is being matched, you might become restless or discouraged.`, try:`Try This: Make a point to balance your playful energy with moments of quiet, calm connection. Instead of waiting for others to guess what you need, practice asking for affirmation directly. It's perfectly okay to say, "I'd really love to hear something encouraging right now."` },
  S: { express:`Expressing Love: You show love through action and initiative. For you, love is a verb. You care for your partner by taking charge—solving problems, creating plans, and protecting the things that matter most to them.`, feel:`Feeling Most Loved: You feel deeply honored when your partner steps in to help with a practical task or takes a burden off your shoulders. Acts of service and practical support speak louder than words to you.`, cautions:`Cautions: Because you're so action-oriented, you might overlook the need for softer, more emotional connection. This can lead to your partner feeling loved through your actions but not necessarily through tenderness or verbal affection.`, try:`Try This: Practice pairing your strong actions with a few simple, verbal affirmations. For example, after you fix something for your partner, you could say, "I did this for you because you're important to me."` },
  R: { express:`Expressing Love: You express your love through deep thought and meaningful presence. For you, a heartfelt conversation and thoughtful words are the truest forms of affection.`, feel:`Feeling Most Loved: You feel most secure when your partner takes the time to truly listen to you. Engaging in a reflective, heart-to-heart dialogue makes you feel understood and deeply cared for.`, cautions:`Cautions: Your high standards for yourself and others can sometimes make your partner feel like they can't measure up. Your tendency to over-analyze can also leave you feeling misunderstood if your partner can't follow your line of thought.`, try:`Try This: Actively communicate your appreciation, not just your concerns. When you're sharing a thought or a concern, try to add a feeling statement alongside it. For example, "I feel cared for when you listen to me so carefully," rather than just "You're a good listener."` },
  A: { express:`Expressing Love: You show love through your calm and steady presence. Your peaceful tone, gentle touch, and quiet demeanor make your partner feel safe and secure.`, feel:`Feeling Most Loved: You feel most cared for when your partner provides a gentle, consistent presence without any pressure. You thrive on a calm, low-key connection that feels reliable and safe.`, cautions:`Cautions: Your tendency to avoid conflict can cause you to hide your own needs until they build up into quiet resentment. This can prevent a healthy resolution of issues and leave you feeling unheard.`, try:`Try This: Challenge yourself to choose one small need each week to voice clearly and directly. For example, you could say, "It would mean a lot to me if we could have a quiet night in this weekend."` },
  U: { express:`Expressing Love: You express your love through consistent service and reliability. Your actions speak volumes, and your message to your partner is always, "You're not alone—I'm with you and I'll be there for you."`, feel:`Feeling Most Loved: You feel truly valued when your partner notices your sacrifices, offers to help you in return, and verbally affirms your loyalty and commitment.`, cautions:`Cautions: You may have a tendency to suppress your own needs, silently hoping that others will notice what you need without you having to ask. When this goes unrecognized, it can lead to quiet hurt and feeling taken for granted.`, try:`Try This: Practice stating a need directly and without apology. It can be as simple as saying, "I'd like to get some rest tonight, so I can't help with that right now." This builds respect and is essential for preventing burnout.` }
};

const SOCIAL_PACK = {
  E: { energy:`Your Social Energy: Your energy is contagious! You're the person who brings enthusiasm and life to any social setting. People are naturally drawn to your optimistic and dynamic presence.`, looks:`What it looks like: You're the one who gets the ball rolling, energized by connection and new ideas. You have a knack for moving things forward and inspiring others with your positive outlook.`, cautions:`Cautions: Your fast-paced, high-energy approach can sometimes move so quickly that you might miss subtle cues or the deeper needs of those around you. You might also accidentally outpace quieter individuals who need more time to process.`, try:`Try This: Make a conscious effort to balance your lively, group-oriented activities with one-on-one check-ins. Try scheduling a coffee chat or a quiet walk with a friend to really listen to their thoughts and feelings.` },
  S: { energy:`Your Social Energy: You are a natural leader who provides structure and direction. Your presence helps groups stay on track and move toward a goal effectively.`, looks:`What it looks like: People look to you for guidance and clarity. You provide a clear path forward, set concrete goals, and are great at protecting the progress a group has already made.`, cautions:`Cautions: Your decisiveness, while valuable, can sometimes come across as controlling if you don't involve others in the process. Remember, a great leader doesn't just give orders; they build consensus.`, try:`Try This: Before making a decision, start by inviting input from others. Use phrases like, "I have an idea for how we can move forward, but I'd love to hear your thoughts first." Also, be sure to name where you're flexible to show you're open to collaboration.` },
  R: { energy:`Your Social Energy: You're a deep thinker who values substance over small talk. You bring a thoughtful, introspective energy to social settings that encourages meaningful conversations.`, looks:`What it looks like: You're the one who asks the insightful questions and thinks deeply before speaking. You appreciate quality time and in-depth discussions, which makes others feel truly seen and understood.`, cautions:`Cautions: Your tendency to over-analyze can sometimes delay decisions or make you seem distant and withdrawn. It can also be a challenge to shift from an intellectual focus to expressing your emotions, which can be essential for true connection.`, try:`Try This: When you need to make a decision, set a timer for yourself to avoid getting stuck in a loop of over-analysis. Additionally, try to practice verbalizing your feelings, not just the facts. For example, instead of just stating a problem, say, "I feel frustrated because of this.”` },
  A: { energy:`Your Social Energy: You bring a sense of calm and stability to social settings. Your presence is reassuring and helps create a low-key, peaceful atmosphere.`, looks:`What it looks like: You are the peacemaker in the group. You naturally reduce friction and keep things running smoothly, making others feel comfortable and relaxed in your presence.`, cautions:`Cautions: Your desire to avoid tension can sometimes lead you to postpone a conversation that's needed for clarity or to resolve an issue. While you prioritize peace, sometimes a little productive tension is necessary for growth.`, try:`Try This: Challenge yourself to name one firm value or non-negotiable area you have, and then clearly name an area where you are willing to be flexible. This allows you to stand your ground while still showing you are open to compromise.` },
  U: { energy:`Your Social Energy: You are a natural caregiver who makes sure others feel included, safe, and valued. Your social energy is all about serving and building trust.`, looks:`What it looks like: You’re often the one who notices if someone is feeling left out and makes a point to include them. You build strong, quiet trust with others through your steady and caring actions.`, cautions:`Cautions: You tend to put the needs of others before your own and may struggle to voice what you need. This can sometimes lead to quiet resentment building up over time if your own needs aren't being met.`, try:`Try This: Practice voicing one specific need you have, even if it feels uncomfortable. It can be as simple as, "I'd really love to talk about something on my mind right now." Also, practice setting a clear boundary, like, "I won't be able to help with that today."` }
};

const POWER_PACK = {
  E: { style:`Your Leadership Style: You lead with enthusiasm! You're a natural motivator who makes decisions with a sense of fun and excitement, which keeps things moving forward with great momentum.`, looks:`What it looks like: You're the one who gets everyone energized and moving. You make quick decisions that prioritize a positive atmosphere and progress, bringing a dynamic and upbeat energy to any team.`, cautions:`Cautions: Your fast-paced approach, while exciting, can sometimes cause you to overlook important details or ignore the perspectives of more reserved team members. You might prioritize the fun of the moment over long-term needs.`, try:`Try This: Make a conscious effort to pause before a final decision. Ask quieter team members for their thoughts and actively listen to their input. This ensures all voices are heard and helps prevent potential issues from being missed.` },
  S: { style:`Your Leadership Style: You are a decisive, goal-oriented leader. You have a clear vision and the ability to set a firm direction, which helps a team achieve its goals efficiently.`, looks:`What it looks like: You take charge and get things done. You're excellent at cutting through indecision and setting clear goals, providing a sense of purpose and direction for the entire group.`, cautions:`Cautions: Your decisiveness can sometimes come across as rigid or controlling if you don't involve others in the process. This can lead to resentment or a feeling of being unheard among your team members.`, try:`Try This: Before a final decision, clarify what's non-negotiable for you (the core goal) and what areas are flexible. This invites collaboration and shows you value the input of others while still maintaining control over the outcome.` },
  R: { style:`Your Leadership Style: You lead with careful analysis and thoughtful consideration. You prefer to understand every detail and all potential outcomes before making a choice.`, looks:`What it looks like: You’re known for a meticulous and thoughtful pace. You ask deep, probing questions and consider all the facts, which leads to well-reasoned and highly informed decisions.`, cautions:`Cautions: Your in-depth analysis can sometimes lead to decision paralysis, slowing down progress and making you seem distant or difficult to read. You may also rely on logic to the exclusion of emotional factors.`, try:`Try This: Set a deadline for yourself to make a decision and stick to it. Also, try to share your feelings and not just your logical conclusions. For instance, you could say, "I'm feeling hesitant about this plan because I'm worried about X."` },
  A: { style:`Your Leadership Style: You are a supportive leader who values harmony and consensus. You excel at keeping the peace and ensuring everyone feels comfortable with the final decision.`, looks:`What it looks like: You bring a calming presence to any team. You are flexible and seek to avoid conflict, which helps reduce friction and makes people feel safe to express themselves.`, cautions:`Cautions: Your desire to avoid tension can sometimes lead to important, difficult issues going unresolved. You might put off necessary conversations to maintain harmony, which can be detrimental in the long run.`, try:`Try This: In a disagreement, name one firm value or non-negotiable area you have, and then clearly name an area where you are willing to be flexible. This allows you to stand your ground while still showing you are open to compromise.` },
  U: { style:`Your Leadership Style: You lead by steadily supporting the plans and shared goals of the team. Your leadership is characterized by loyalty and a desire to serve the group's best interests.`, looks:`What it looks like: You are a dependable and steadfast supporter of team efforts. You build trust by consistently following through and putting the group's needs first, which makes you a highly valued team member.`, cautions:`Cautions: Your tendency to prioritize others' preferences can cause you to suppress your own ideas or needs, which can lead to quiet resentment or a feeling of being overlooked.`, try:`Try This: Before you agree to a plan, state one specific need or preference you have early in the discussion. For example, "I'm happy to help with this project, but I'd like to make sure we include X."` }
};

const RR_PACK = {
  Strong:{title:"Strong (Score 5–6)", result:`Your Result: You have a solid foundation of mutual respect. You generally feel valued, affirmed, and genuinely appreciated, and you have a natural tendency to give that same affirmation to others in return.`, looks:`What it looks like: You and your partner likely celebrate each other's contributions and feel a deep sense of alignment in your core values. There's a feeling of being on the same team, where efforts are seen and honored.`, cautions:`Cautions: When affirmation comes so naturally, it's easy to take that consistency for granted. You might fall into the trap of using general praise instead of specific, meaningful words.`, try:`Try This: Challenge yourself to add more specificity to your affirmations. Instead of simply saying, "Thanks for doing that," try something like, "I really appreciate how you handled that conversation; it showed so much wisdom and care." This kind of specific recognition makes your partner feel truly seen.` },
  Moderate:{title:"Moderate (Score 3–4)", result:`Your Result: You often feel respected, but there are times when you long for clearer appreciation or more intentional recognition.`, looks:`What it looks like: You may occasionally wonder if your efforts are truly noticed or if your values are fully shared by your partner. This can lead to moments of uncertainty about your place in the relationship.`, cautions:`Cautions: If a need for recognition is not met intentionally, one partner may start to feel quietly undervalued. Over time, this can lead to emotional distance or feelings of being taken for granted.`, try:`Try This: Take the initiative to voice one concrete way you'd like to feel honored. It's not nagging; it's providing a clear guide. For example, you could say, "It really helps me feel valued when you say thank you for the small, everyday things, like making dinner or folding the laundry."` },
  "Needs Attention":{title:"Needs Attention (Score 0–2)", result:`Your Result: You may not consistently feel valued, affirmed, or recognized for your contributions or personal beliefs.`, looks:`What it looks like: Your efforts may frequently go unnoticed, leaving a space for insecurity and a feeling of being misaligned in your relationship. This can feel like you're putting in a lot of work without your partner seeing or appreciating it.`, cautions:`Cautions: If left unspoken, this lack of recognition can create significant emotional distance and resentment, making it feel like you are not on the same side.`, try:`Try This: It's time to have a gentle but honest conversation. Approach your partner by sharing your feelings using "I" statements. For example, you could say, "When you notice what I do, I feel seen and respected. Could you please try to name one thing you appreciate each day?" This provides a simple, actionable step that can begin to close the gap.` }
};

const PATTERN_PACK = {
  SteadyConnector:{title:"Steady Connector", result:`Your Result: You have a steady, calm, and harmony-focused connection style. You naturally de-escalate tension and create a safe space for conversation to happen. Your presence is reassuring.`, looks:`What it looks like: You're the one who can bring a sense of calm to a heated moment. You prioritize peace and create an environment where your partner feels safe to express themselves without fear of a major argument.`, cautions:`Cautions: Your desire for harmony might cause you to smooth over conflict too quickly, leaving important issues unresolved. While you avoid a big fight, the underlying problem may still be there, waiting to resurface later.`, try:`Try This: To ensure you're addressing issues fully, try implementing a short, daily check-in. For five minutes, each of you can name one feeling, one need, and one next step before moving on. This simple structure ensures you're addressing the deeper issues without a major conflict.` },
  ReassuranceSeeker:{title:"Reassurance Seeker", result:`Your Result: Your connection style is passionate and driven by closeness. You're quick to notice when something feels off and you work hard to repair the connection.`, looks:`What it looks like: You actively fight for clarity and reassurance, wanting to fix things as soon as they feel broken. Your desire to reconnect quickly is a sign of how deeply you value your partner.`, cautions:`Cautions: Your urgency for reassurance can sometimes feel overwhelming to your partner, especially if they need a moment to process. If you push for a quick resolution before they're ready, it might create more distance instead of closing it.`, try:`Try This: In moments of tension, ask for one clear reassurance from your partner. Then, agree to a short reset with a promised return time. You might say, "Can you just tell me you love me right now? I need twenty minutes to calm down, but I promise I'll be back to talk about this then." This gives both of you what you need.` },
  IndependentConnector:{title:"Independent Connector", result:`Your Result: Your connection style values clarity and personal reflection. You have a natural tendency to de-escalate conflict by stepping back to think carefully.`, looks:`What it looks like: When a conversation gets heated, your instinct is to withdraw and process your thoughts. You use this pause to gain clarity and avoid saying something you might regret, which can be very effective.`, cautions:`Cautions: If you step away without setting a clear return time, your partner may interpret your pause as withdrawal or disconnection, leading to feelings of abandonment.`, try:`Try This: Communicate your need for space with reassurance. Say, "I need about 20 minutes to think about this, but I promise I will come back to talk." By adding a short sentence of reassurance before you step away—like, "I love you, and this is important to me"—you show that you're pausing for the good of the relationship, not to escape it.` },
  GuardedConnector:{title:"Guarded Connector", result:`Your Result: Your connection style is cautious and focuses on building trust slowly. You protect the relationship by avoiding overreactions and showing steady, quiet loyalty.`, looks:`What it looks like: You're a rock in the relationship, showing your commitment through steady presence and avoiding drama. This sense of loyalty is a cornerstone of your connection style.`, cautions:`Cautions: Your caution can sometimes look like a wall, leaving your partner feeling shut out or unable to get close to you emotionally. Your reluctance to be vulnerable can create a sense of emotional distance.`, try:`Try This: To build trust, try engaging in micro-trust exercises. Before a hard conversation, share one safe truth, keep a small promise, or write a short note about something you appreciate. These small acts of vulnerability help your partner feel a little safer, making them more willing to open up to you in return.` }
};

function accentByTemp(t){ const map={ E:{color:typeColors.Emotional,bg:typeOpac.Emotional}, S:{color:typeColors.Commitment,bg:typeOpac.Commitment}, R:{color:typeColors.Intellectual,bg:typeOpac.Intellectual}, A:{color:typeColors.Affable,bg:typeOpac.Affable}, U:{color:typeColors.Partnership,bg:typeOpac.Partnership} }; return map[t] || { color:"#4D9DE0", bg:"rgba(77,157,224,.08)" }; }
function emphasizeLabelPrefix(text){ if(!text || typeof text !== 'string') return text; const i = text.indexOf(':'); if (i > 0) { const label = text.slice(0, i); const rest = text.slice(i+1); return `<strong><em>${label}</em>:</strong>${rest}`; } return text; }

function promptsBlockEditable(key, questions){ const id='pb_'+key; const items=questions.map((q,i)=>`<li>${q}<br><textarea class="prompt-input" data-key="${key}" data-idx="${i}" rows="3" placeholder="Write your notes here…"></textarea></li>`).join(""); const html=`<div class="prompt-block" id="${id}"><span class="discussion-title">Discussion Notes</span><ol class="results-list" style="margin-top:6px;">${items}</ol></div>`; return { id, html, count: questions.length }; }
function wirePromptBlock(id, key, count){ const root=document.getElementById(id); if(!root) return; const areas=root.querySelectorAll('textarea.prompt-input'); areas.forEach(ta=>{ const idx=ta.getAttribute('data-idx'); const noteKey=key+'_'+idx; if(answers?.notes && typeof answers.notes==='object' && answers.notes[noteKey]) ta.value=answers.notes[noteKey]; ta.addEventListener('input', ()=>{ if(!answers.notes) answers.notes={}; answers.notes[noteKey]=ta.value; saveState(); }); }); }

/* ---- finalize & results ---- */
function finalize(){
  ensureDefaults();
  const socialTop = answers.social?.social1 || answers.social?.social2 || null;
  const decisionTop = answers.decision?.decision1 || answers.decision?.decision2 || null;
  const rr1 = Number.isFinite(answers.rr?.rr1) ? answers.rr.rr1 : 0;
  const rr2 = Number.isFinite(answers.rr?.rr2) ? answers.rr.rr2 : 0;
  const rrScore = rr1 + rr2; const rrLabel = rrScore >= 5 ? "Strong" : rrScore >= 3 ? "Moderate" : "Needs Attention";
  const bonds = [answers.bond?.bond1, answers.bond?.bond2, answers.bond?.bond3, answers.bond?.bond4].filter(Boolean);
  let bondingKey = "SteadyConnector"; if(bonds.length){ const counts={}; bonds.forEach(b=>counts[b]=(counts[b]||0)+1); bondingKey = Object.entries(counts).sort((a,b)=>b[1]-a[1])[0][0]; }
  const p = { name: yourName || "You", corePicks:[...(answers.coreTop2||[])], collabPicks:[...(answers.collabTop2||[])], relatePicks:[...(answers.relateTop2||[])], expressedTop2: answers.expressedTop2||[], desiredTop2: answers.desiredTop2||[], socialTop, decisionTop, rrScore, rrLabel, bondingKey };
  renderResults(p);
}

function compassionCareColumn(p){ const codeMap={ Sanguine:"E", Choleric:"S", Melancholy:"R", Phlegmatic:"A", Supine:"U" }; const mk=(tempLabel,which)=>{ const t=codeMap[tempLabel]; const pack=APS_CARE[t]; if(!pack) return ""; const acc=accentByTemp(t); return `<div class="result-block" style="border-left-color:${acc.color}; background:${acc.bg};"><strong>${which}</strong><p style="margin:.4em 0 0;">${emphasizeLabelPrefix(pack.express)}</p><p style="margin:.4em 0 0;">${emphasizeLabelPrefix(pack.feel)}</p><p style="margin:.4em 0 0;">${emphasizeLabelPrefix(pack.cautions)}</p><p style="margin:.4em 0 0;"><em>${emphasizeLabelPrefix(pack.try)}</em></p></div>`; };
  const expHtml=(p.expressedTop2||[]).map(k=>mk(k,"Expressing Love")).join("")||`<div class="result-block" style="border-left-color:#4D9DE0;background:rgba(77,157,224,.08);">Make selections earlier to see personalized details.</div>`;
  const desHtml=(p.desiredTop2||[]).map(k=>mk(k,"Feeling Most Loved")).join("")||`<div class="result-block" style="border-left-color:#4D9DE0;background:rgba(77,157,224,.08);">Make selections earlier to see personalized details.</div>`;
  return `<div class="partner-card"><div class="partner-inner"><div class="partner-header">${p.name||"You"}</div>${expHtml}${desHtml}</div></div>`;
}
function socialPreferencesCard(p){ const code=p.socialTop||"E"; const pack=SOCIAL_PACK[code]||SOCIAL_PACK.E; const acc=accentByTemp(code); return `<div class="result-block" style="border-left-color:${acc.color}; background:${acc.bg};"><p><strong>Your Social Energy</strong></p><p>${emphasizeLabelPrefix(pack.energy)}</p><p>${emphasizeLabelPrefix(pack.looks)}</p><p>${emphasizeLabelPrefix(pack.cautions)}</p><p><em>${emphasizeLabelPrefix(pack.try)}</em></p></div>`; }
function powerControlCard(p){ const code=p.decisionTop||"S"; const pack=POWER_PACK[code]||POWER_PACK.S; const acc=accentByTemp(code); return `<div class="result-block" style="border-left-color:${acc.color}; background:${acc.bg};"><p><strong>Your Leadership Style</strong></p><p>${emphasizeLabelPrefix(pack.style)}</p><p>${emphasizeLabelPrefix(pack.looks)}</p><p>${emphasizeLabelPrefix(pack.cautions)}</p><p><em>${emphasizeLabelPrefix(pack.try)}</em></p></div>`; }
function respectRecognitionCard(p){ const pack=RR_PACK[p.rrLabel]||RR_PACK.Moderate; const color=(p.rrLabel==="Strong")?typeColors.Partnership:(p.rrLabel==="Moderate")?typeColors.Commitment:typeColors.Emotional; const bg=(p.rrLabel==="Strong")?typeOpac.Partnership:(p.rrLabel==="Moderate")?typeOpac.Commitment:typeOpac.Emotional; return `<div class="result-block" style="border-left-color:${color}; background:${bg};"><strong>${pack.title}</strong> <span>(${Number.isFinite(p.rrScore)?p.rrScore:0}/6)</span><p style="margin:.4em 0 0;">${emphasizeLabelPrefix(pack.result)}</p><p style="margin:.4em 0 0;">${emphasizeLabelPrefix(pack.looks)}</p><p style="margin:.4em 0 0;">${emphasizeLabelPrefix(pack.cautions)}</p><p style="margin:.4em 0 0;"><em>${emphasizeLabelPrefix(pack.try)}</em></p></div>`; }
function connectionPatternCard(p){ const key=p.bondingKey||"SteadyConnector"; const pack=PATTERN_PACK[key]||PATTERN_PACK.SteadyConnector; const acc={ SteadyConnector:{ color:typeColors.Partnership,bg:typeOpac.Partnership }, ReassuranceSeeker:{ color:typeColors.Emotional,bg:typeOpac.Emotional }, IndependentConnector:{ color:typeColors.Intellectual,bg:typeOpac.Intellectual }, GuardedConnector:{ color:typeColors.Conflict,bg:typeOpac.Conflict } }[key]||{ color:"#4D9DE0", bg:"rgba(77,157,224,.08)" }; return `<div class="partner-card"><div class="partner-inner"><div class="partner-header">${p.name||"You"}</div><div class="result-block" style="border-left-color:${acc.color}; background:${acc.bg};"><p><strong>${pack.title}</strong></p><p>${emphasizeLabelPrefix(pack.result)}</p><p>${emphasizeLabelPrefix(pack.looks)}</p><p>${emphasizeLabelPrefix(pack.cautions)}</p><p><em>${emphasizeLabelPrefix(pack.try)}</em></p></div></div></div>`; }

// Top intro (replace old subtitle/verse + welcome)
function renderResults(p){
  // Show results page
  hideAllPages();
  document.getElementById('resultPage').classList.remove('hidden');

  // Top intro (replace old subtitle/verse + welcome)
  const subtitleEl = document.querySelector('#resultPage .subtitle-blue');
  if (subtitleEl) subtitleEl.remove();
  const verseEl = document.getElementById('topVerse');
  if (verseEl) verseEl.innerHTML = '';

  const introSlot = document.getElementById('resultsIntro');
  introSlot.innerHTML = `
    <p>Welcome to the Marriage Connection Assessment. This experience is built on the foundation of the covenant marriage model found in <em>Happy Marriage, Happy Life: A Comprehensive Covenant Marriage Model for Lasting Love and Fulfillment</em>. Our goal is to help you build a joyful marriage as God designed, one that reflects the timeless truth that</p>
    <p class="verse" style="margin-top:6px;">
    “Love is patient, love is kind. It does not envy, it does not boast, it is not proud.
    It does not dishonor others, it is not self-seeking, it is not easily angered,
    it keeps no record of wrongs. Love does not delight in evil but rejoices with the truth.
    It always protects, always trusts, always hopes, always perseveres.”
    — 1 Corinthians 13:4–7
    </p>
    <p>This is your personalized guide to understanding connection in a new way—a living map to the unique landscape of your relationship. It helps you name what’s true today and aim for what’s possible tomorrow.</p>
    <p>Your journey to a deeper connection begins now.</p>
  `;

  // Mount + helpers for safe rendering
  const mount = document.getElementById('results');
  mount.innerHTML = "";
  const container = document.createElement('div');
  container.id = "soloReport";
  mount.appendChild(container);

  const addDivider = () => {
    const d = document.createElement('div');
    d.className = 'section-divider';
    container.appendChild(d);
  };
  const addSubDivider = () => {
    const d = document.createElement('div');
    d.className = 'subsection-divider';
    container.appendChild(d);
  };
  const addHTML = (html) => {
    const tmp = document.createElement('div');
    tmp.innerHTML = html;
    while (tmp.firstChild) container.appendChild(tmp.firstChild);
  };
  const safe = (label, fn) => {
    try { fn(); }
    catch(e){
      console.error('Results render error @', label, e);
      addHTML(`<p class="muted">(Note) A section failed to load. Continuing…</p>`);
    }
  };

  // ===============================
  // Section 1: Your Intimacy Preferences
  // ===============================
  safe('s1-head', () => {
    addDivider();
    addHTML('<a id="s1"></a>');
    addHTML(`
      <h3 class="section-title">Section 1: Your Intimacy Preferences</h3>
      <div class="verse">“Therefore a man shall leave his father and his mother and hold fast to his wife, and they shall become one flesh.” — Genesis 2:24</div>
      <div class="intro-text">
        Becoming "one flesh" is a journey far beyond the physical; it's the profound experience of being truly known, deeply connected, and fully cherished by your spouse.
        This model helps you understand your unique connection profile, revealing how you naturally express love and how you feel most loved in return.
        <p>We've organized this journey into 12 distinct types of intimacy that cover all aspects of your life together. This model combines the essential parts of 'being together'—like your emotional and spiritual bonds—with 'doing together'—like shared effort and practical teamwork. This reflects how love truly thrives in the beautiful, everyday reality of marriage.</p>
        <p>Think of these types as the most rewarding pathways and sometimes the trickiest intersections in your relationship. Understanding your preferences gives you and your spouse a shared language to express your needs, navigate your connection, and intentionally build a more fulfilling union. Your results are a vibrant guide to deepening your one-of-a-kind bond.</p>
      </div>
    `);
  });

  // Foundational Intimacies (Core)
  safe('s1-core', () => {
    addSubDivider();
    addHTML('<a id="s1-core"></a>');
    addHTML(`
      <h4 class="subsection-title">The Foundational Intimacies</h4>
      <div class="subtitle-blue">Your Core Connections</div>
      <p class="intro-text">This is the most important layer—the foundation of your relationship. You can't build a stable house without solid ground, and you can't build a lasting relationship without these core elements. They are the non-negotiable pillars that give your relationship purpose, trust, and resilience.</p>
    `);
    if ((p.corePicks||[]).length){
      addHTML(`<p class="intro-text" style="text-align:center; font-style:italic; color:#4D9DE0;">Your top two preferences are: <strong>${p.corePicks.map(k=>INTIMACY[k].label.replace(/Intimacy/gi,'Connection')).join('</strong>, <strong>')}</strong></p>`);
    }
    addHTML(`
      <div class="result-block" style="border-left-color:${typeColors.Spiritual}; background:${typeOpac.Spiritual};">
  <strong>Spiritual Intimacy</strong>
  <p>This is your shared compass. It's a deep sense of purpose and connection to God’s design that anchors your relationship, shaping how you love each other. Ultimately, this foundational bond guides your journey together through life's ups and downs.</p>
  <p class="learn-more-wrap">
    <a class="learn-more" href="https://www.happymarriagehappylife.com/post/spiritual-intimacy-the-compass-of-covenant-marriage" target="_blank" rel="noopener">
      Read more about Spiritual Intimacy
    </a>
  </p>
</div>


      <div class="result-block" style="border-left-color:${typeColors.Commitment}; background:${typeOpac.Commitment};">
  <strong>Commitment Intimacy</strong>
  <p>Think of this as the main support beam of your relationship. It’s the unwavering security that comes from knowing you're both dedicated for the long haul, providing the stability you need to face any challenge. This profound bond allows you to deepen your connection over time, no matter what.</p>
  <p class="learn-more-wrap">
    <a class="learn-more" href="https://www.happymarriagehappylife.com/post/commitment-intimacy" target="_blank" rel="noopener">
      Read more about Commitment Intimacy
    </a>
  </p>
</div>

      <div class="result-block" style="border-left-color:${typeColors.Stability}; background:${typeOpac.Stability};"><strong>Stability Intimacy</strong><p>This is about building a practical and secure future as a team. It’s the trust you forge by honestly managing life's resources, like time and money, and aligning your values to work toward a common goal. This crucial collaboration ensures your partnership is built on a solid, reliable foundation.</p></div>
      <div class="result-block" style="border-left-color:${typeColors.Emotional}; background:${typeOpac.Emotional};"><strong>Emotional Intimacy</strong><p>This is the absolute heart of your connection. It’s about feeling safe enough to be truly vulnerable, sharing your deepest feelings and fears without judgment. This crucial bond is the gateway that allows all other forms of closeness to flourish.</p></div>
    `);
    const pb = promptsBlockEditable('s1core', [
      'Which two core connections feel most like your foundation—and why?',
      'What daily habit would strengthen one core area this week?',
      'Where do you feel a bit unsteady, and what small step could help?'
    ]);
    addHTML(pb.html); wirePromptBlock(pb.id, 's1core', pb.count);
  });

  // Partnership Intimacies (Collaborative)
  safe('s1-collab', () => {
    addSubDivider();
    addHTML('<a id="s1-collab"></a>');
    addHTML(`
      <h4 class="subsection-title">The Partnership Intimacies</h4>
      <div class="subtitle-blue">Your Collaborative Connections</div>
      <p class="intro-text">Once the foundation is set, you start building the structure of your house—this is the partnership layer. These are the active, hands-on ways you work together to build a shared life. They're about functioning as a cohesive team to tackle life's projects and challenges.</p>
    `);
    if ((p.collabPicks||[]).length){
      addHTML(`<p class="intro-text" style="text-align:center; font-style:italic; color:#4D9DE0;">Your top two preferences are: <strong>${p.collabPicks.map(k=>INTIMACY[k].label.replace(/Intimacy/gi,'Connection')).join('</strong>, <strong>')}</strong></p>`);
    }
    addHTML(`
      <div class="result-block" style="border-left-color:${typeColors.Partnership}; background:${typeOpac.Partnership};"><strong>Partnership Intimacy</strong><p>This is the feeling of being a unified team. It’s the collaborative connection you build by tackling daily chores and big decisions together, side-by-side. This shared effort forges a powerful bond as you function as a single unit, tackling life’s challenges together.</p></div>
      <div class="result-block" style="border-left-color:${typeColors.Creative}; background:${typeOpac.Creative};"><strong>Creative Intimacy</strong><p>This is the shared joy of building and dreaming. It’s about bringing new ideas to life as a duo, whether it’s a shared project or a vision for your future. This bond is strengthened through the collaborative process of seeing your shared vision become a reality.</p></div>
      <div class="result-block" style="border-left-color:${typeColors.Conflict}; background:${typeOpac.Conflict};"><strong>Conflict Intimacy</strong><p>This might sound strange, but it’s your secret weapon. It’s the ability to fight fair, navigate disagreements with mutual respect, and actually grow closer through the process of resolving issues. It shows that your connection is strong enough to handle differences without breaking.</p></div>
      <div class="result-block" style="border-left-color:${typeColors.Intellectual}; background:${typeOpac.Intellectual};"><strong>Intellectual Intimacy</strong><p>This is the meeting of your minds. It’s that mental spark from sharing ideas, having deep conversations, and exploring new perspectives with mutual respect for each other’s thoughts. This powerful bond is forged by the exchange of ideas and a curiosity about each other’s inner worlds.</p></div>
    `);
    const pb = promptsBlockEditable('s1collab', [
      'Where do you already function as a strong team?',
      'What is one system or routine we could improve together?',
      'Name one “we” project to start this month.'
    ]);
    addHTML(pb.html); wirePromptBlock(pb.id, 's1collab', pb.count);
  });

  // Connection Intimacies (Relational)
  safe('s1-relate', () => {
    addSubDivider();
    addHTML('<a id="s1-relate"></a>');
    addHTML(`
      <h4 class="subsection-title">The Connection Intimacies</h4>
      <div class="subtitle-blue">Your Relational Connections</div>
      <p class="intro-text">With the house built, it's time to make it a home. This is the connection layer, which brings vitality and joy to your day-to-day life. These are the daily interactions and expressions of affection that keep your relationship vibrant and alive.</p>
    `);
    if ((p.relatePicks||[]).length){
      addHTML(`<p class="intro-text" style="text-align:center; font-style:italic; color:#4D9DE0;">Your top two preferences are: <strong>${p.relatePicks.map(k=>INTIMACY[k].label.replace(/Intimacy/gi,'Connection')).join('</strong>, <strong>')}</strong></p>`);
    }
    addHTML(`
      <div class="result-block" style="border-left-color:${typeColors.Physical}; background:${typeOpac.Physical};"><strong>Physical Intimacy</strong><p>This is the warmth of non-sexual touch that provides a deep sense of security. It’s the comfort of holding hands, cuddling, or a hug that affirms your bond through simple gestures and presence. This kind of closeness creates a sense of safety and a feeling of being fully cherished.</p></div>
      <div class="result-block" style="border-left-color:${typeColors.Sexual}; background:${typeOpac.Sexual};"><strong>Sexual Intimacy</strong><p>This is a passionate and exclusive expression of your committed bond. It’s a unique and powerful way to honor your connection through shared vulnerability and pleasure. This sacred physical union expresses a deep level of intimacy that only you two share.</p></div>
      <div class="result-block" style="border-left-color:${typeColors.Affable}; background:${typeOpac.Affable};"><strong>Affable Intimacy</strong><p>This is the simple, peaceful comfort of your daily rhythm. It’s the ease of being agreeable and genuinely enjoying each other's company in your everyday interactions. This kind of closeness creates a peaceful and enjoyable environment, making your relationship feel like a safe haven.</p></div>
      <div class="result-block" style="border-left-color:${typeColors.Recreational}; background:${typeOpac.Recreational};"><strong>Recreational Intimacy</strong><p>This is all about the fun stuff! It’s the shared laughter and joy from hobbies and adventures that brings vitality and fun to your relationship. This kind of intimacy creates cherished memories that strengthen your bond through shared experiences.</p></div>
    `);
    const pb = promptsBlockEditable('s1relate', [
      'Which interactions refuel you most and why?',
      'Name a small practice we can add this week to increase connection.',
      'How can we celebrate or play together more intentionally?'
    ]);
    addHTML(pb.html); wirePromptBlock(pb.id, 's1relate', pb.count);
  });

  // ===============================
  // Section 2: Relational Dynamics
  // ===============================
  safe('s2-head', () => {
    addDivider();
    addHTML('<a id="s2"></a>');
    addHTML(`
      <h3 class="section-title">Section 2: Relational Dynamics</h3>
      <div class="intro-text">Your relationship isn't just a connection of two people; it's a unique dance of two beautiful, distinct individuals! This section is designed to help you understand the everyday rhythms that shape your connection. We'll explore how you naturally care for each other, how you engage socially, how you share influence and make decisions, and how you honor one another. Our hope is that these insights will not only bring clarity but also provide a powerful guide for your discussions, helping you protect your closeness and deepen your bond in every interaction.</div>
    `);
  });

  // Compassion & Care
  safe('s2-compassion', () => {
    addSubDivider();
    addHTML('<a id="s2-care"></a>');
    addHTML(`
      <h4 class="subsection-title">Compassion & Care</h4>
      <div class="framing-q">Do you care about me?</div>
      <div class="verse">“Be completely humble and gentle; be patient, bearing with one another in love.” — Ephesians 4:2</div>
      <div class="intro-text">This dynamic delves into the heart of your relationship: how love, empathy, and emotional needs are expressed and received. It reveals your unique capacity for tenderness, emotional availability, nurturing, and presence. At its core, this is where you answer the profound question, "Do you care about me?"—both in how you show up for your spouse and how you long to receive comfort and support in return. Understanding this area helps you both ensure your hearts feel truly seen and safe.</div>
    `);
    addHTML(compassionCareColumn(p));
    const pb = promptsBlockEditable('s2care', [
      'When do you feel most cared for by me?',
      'What is one specific way I can support your heart this week?',
      'What could I do less of so you feel safer and more seen?'
    ]);
    addHTML(pb.html); wirePromptBlock(pb.id, 's2care', pb.count);
  });

  // Social Preferences
  safe('s2-social', () => {
    addSubDivider();
    addHTML('<a id="s2-social"></a>');
    addHTML(`
      <h4 class="subsection-title">Social Preferences</h4>
      <div class="framing-q">How do you recharge?</div>
      <div class="verse">“Therefore encourage one another and build each other up.” — 1 Thessalonians 5:11</div>
      <div class="intro-text">This dynamic is all about how you both recharge and engage with the world around you. It explores whether you feel energized by being with others (extraversion), find deep renewal in solitude (introversion), or perhaps thrive with a mix of both (ambiversion). Understanding these unique preferences is key to helping you and your spouse beautifully balance your needs for connection and personal space, ensuring you both feel filled up and ready to encourage each other daily.</div>
    `);
    addHTML(socialPreferencesCard(p));
    const pb = promptsBlockEditable('s2social', [
      'Describe your ideal way to recharge alone and together.',
      'What boundary or rhythm would help us honor both needs?',
      'Plan one social/quiet moment we can try this week.'
    ]);
    addHTML(pb.html); wirePromptBlock(pb.id, 's2social', pb.count);
  });

  // Power & Control
  safe('s2-power', () => {
    addSubDivider();
    addHTML('<a id="s2-power"></a>');
    addHTML(`
      <h4 class="subsection-title">Power & Control</h4>
      <div class="framing-q">Who gets to decide?</div>
      <div class="verse">“If any of you lacks wisdom, you should ask God … and it will be given to you.” — James 1:5</div>
      <div class="intro-text">With this dynamic explores how you navigate decisions and leadership within your relationship, and how you approach influence and authority. It's all about how decisions are made, roles are shared, and influence is balanced. Understanding this helps you create a structure where shared responsibility and collaboration feel both respectful and safe. At its heart, this dynamic helps you to ensure the balance and mutual honor in your daily interactions.</div>
    `);
    addHTML(powerControlCard(p));
    const pb = promptsBlockEditable('s2power', [
      'What decision-making habit serves us well?',
      'Where could we share influence more fairly?',
      'Design a quick check-in ritual for tough decisions.'
    ]);
    addHTML(pb.html); wirePromptBlock(pb.id, 's2power', pb.count);
  });

  // Respect & Recognition
  safe('s2-rr', () => {
    addSubDivider();
    addHTML('<a id="s2-rr"></a>');
    addHTML(`
      <h4 class="subsection-title">Respect & Recognition</h4>
      <div class="framing-q">Do you value me?</div>
      <div class="verse">“Honor one another above yourselves.” — Romans 12:10</div>
      <div class="intro-text">This dynamic shines a light on how you both value, affirm, and truly see each other for who you are. It explores how you seek to be known, understood, and deeply appreciated, and in turn, how you honor your spouse's unique identity and contributions. At its heart, this dynamic helps you to ensure the dignity, affirmation, and genuine respect flourish in your relationship.</div>
    `);
    addHTML(respectRecognitionCard(p));
    const pb = promptsBlockEditable('s2rr', [
      'What makes you feel most honored by me?',
      'Name one way we can show recognition daily.',
      'What recent effort of yours should I acknowledge right now?'
    ]);
    addHTML(pb.html); wirePromptBlock(pb.id, 's2rr', pb.count);
  });

  // ===============================
  // Section 3: Connection Patterns
  // ===============================
  safe('s3-connpatterns', () => {
    addDivider();
    addHTML('<a id="s3"></a>');
    addHTML(`
      <h3 class="section-title">Section 3: Connection Patterns</h3>
      <div class="framing-q">How do you reconnect?</div>
      <div class="verse">“…with all humility and gentleness, with patience, bearing with one another in love, eager to maintain the unity of the Spirit in the bond of peace.” — Ephesians 4:2–3</div>
      <div class="intro-text">These results show how you tend to respond to perceived conflict and how you prefer to repair. Learning your strengths, challenges, and blind spots here is key to a healthier, more resilient relationship.</div>
    `);
    addHTML(connectionPatternCard(p));
    const pb = promptsBlockEditable('s3patterns', [
      'What usually triggers disconnection for you?',
      'What quick repair step works best for us?',
      'Write a one-sentence reassurance you’d like to hear.'
    ]);
    addHTML(pb.html); wirePromptBlock(pb.id, 's3patterns', pb.count);
  });

  // ===============================
  // Section 4: Communication Style
  // ===============================
  safe('s4-commstyle', () => {
    addDivider();
    addHTML('<a id="s4"></a>');
    addHTML(`
      <h3 class="section-title">Section 4: Communication Style</h3>
      <div class="verse">“My dear brothers and sisters, take note of this: Everyone should be quick to listen, slow to speak and slow to become angry, because human anger does not produce the righteousness that God desires.” — James 1:19–20</div>
      <div class="intro-text">This section of your results is designed to help you understand your primary communication style—the innate way you tend to express yourself and others. Think of it as your natural rhythm for conversation and connection. Your results will show you what you need to feel heard and how you naturally communicate. Understanding this can help you better manage conflict, deepen intimacy, and feel more confident in expressing yourself in every relationship.</div>
    `);

    const style = (function(){
      const bond = p.bondingKey || "SteadyConnector";
      const rr = (typeof p.rrScore === 'number') ? p.rrScore : 0;
      const dec = p.decisionTop || null;
      const soc = p.socialTop || null;
      if (bond === "IndependentConnector") return "Avoidant / Withdrawn";
      if (bond === "GuardedConnector")     return "Passive-Aggressive";
      if (bond === "ReassuranceSeeker"){
        if (dec === 'S' || rr <= 2) return "Aggressive";
        return "Assertive";
      }
      if (bond === "SteadyConnector"){
        if (rr >= 5 && dec !== 'S') return "Collaborative / Empathetic";
        if (dec === 'A' || soc === 'A' || soc === 'U') return "Passive";
        return "Collaborative / Empathetic";
      }
      return "Assertive";
    })();

    const COMM_STYLE_DEF = {
      "Passive":{copy:`According to your assessment, you tend to use a passive communication style. This means you often avoid conflict and may find yourself going along with others to keep the peace. You might withhold your opinions and feelings to prevent disagreement, which can sometimes lead to resentment or emotional distance building up over time.`,move:`For the Passive Communicator: Start by taking small steps to voice your opinions and needs. Instead of saying, "Whatever you want to do is fine," try, "I'd actually prefer to go to the movies tonight, how does that sound to you?"`},
      "Aggressive":{copy:`Your results indicate a strong tendency toward an aggressive communication style. This approach is direct and forceful, and you may find yourself dominating conversations or interrupting others to push your own perspective. This style is often linked to a desire for control and can leave others feeling unheard or overpowered. The goal is to learn to express your needs powerfully while also creating space for others to share theirs.`,move:`For the Aggressive Communicator: Practice using "I" statements instead of "you" statements. For example, change "You always interrupt me" to "I feel unheard when I'm interrupted." This shifts the focus from blame to personal experience.`},
      "Passive-Aggressive":{copy:`Based on your assessment, you lean toward a passive-aggressive communication style. This can show up as sarcasm, giving the silent treatment, or making subtle jabs instead of being direct about what you need. This style can be especially damaging because it combines hostility with avoidance, leaving issues unresolved and creating frustration for everyone involved. A great next step is to practice being more direct and open in your conversations.`,move:`For the Passive-Aggressive Communicator: Be direct. When you feel frustrated, instead of making a sarcastic comment, try saying, "I'm feeling frustrated right now because of X." This allows for an honest conversation rather than a hidden conflict.`},
      "Avoidant / Withdrawn":{copy:`Your results suggest you often use an avoidant/withdrawn communication style. When things get difficult, you might find yourself shutting down, disengaging, or "stonewalling" during conversations. This style is common when people feel overwhelmed or are trying to avoid conflict entirely. It can prevent issues from being resolved and create emotional distance. Learning to stay present in difficult conversations is a great place to start.`,move:`For the Avoidant/Withdrawn Communicator: Learn to manage your overwhelm by taking a short break. Say, "I'm feeling overwhelmed right now. Can we talk about this in 15 minutes?" This is a much healthier alternative to stonewalling, as it communicates a clear intention to return to the conversation.`},
      "Assertive":{copy:`Congratulations! Your assessment shows you have a strong assertive communication style. This is considered the healthiest approach, as you are able to clearly and respectfully express your needs while also genuinely respecting the other person's perspective. This balanced style builds trust and intimacy because it blends honesty with empathy. Keep up the great work!`,move:`For the Assertive Communication: Balance your style with the other healthy style, Collaborative / Empathetic Communication. This is a strengths-based approach where you actively listen, validate others' feelings, and work together to solve problems. It's very similar to assertive communication but has an even stronger focus on cooperation and understanding. This style helps build strong, intimate relationships.`},
      "Collaborative / Empathetic":{copy:`Your assessment highlights a natural inclination toward a collaborative/empathetic communication style. This is a strengths-based approach where you actively listen, validate others' feelings, and work together to solve problems. It's very similar to assertive communication but has an even stronger focus on cooperation and understanding. This style helps build strong, intimate relationships.`,move:`For the Collaborative / Empathetic Communication: Balance with the other healthy type “Assertive Communication.” This is considered the healthiest approach, as you are able to clearly and respectfully express your needs while also genuinely respecting the other person's perspective. This balanced style builds trust and intimacy because it blends honesty with empathy. Keep up the great work!`}
    };
    const colorMap = {
      "Passive":typeColors.Affable, "Aggressive":typeColors.Commitment, "Passive-Aggressive":typeColors.Conflict,
      "Assertive":typeColors.Intellectual, "Avoidant / Withdrawn":typeColors.Partnership, "Collaborative / Empathetic":typeColors.Emotional
    };
    const bgMap = {
      "Passive":typeOpac.Affable, "Aggressive":typeOpac.Commitment, "Passive-Aggressive":typeOpac.Conflict,
      "Assertive":typeOpac.Intellectual, "Avoidant / Withdrawn":typeOpac.Partnership, "Collaborative / Empathetic":typeOpac.Emotional
    };

    const pack = COMM_STYLE_DEF[style] || COMM_STYLE_DEF["Assertive"];
    addHTML(`<div class="result-block" style="border-left-color:${colorMap[style]}; background:${bgMap[style]};"><p><strong>${style} Communication</strong></p><p>${pack.copy}</p></div>`);
    addSubDivider();
    addHTML(`<h4 class="subsection-title">Moving from Conflict to Connection: Communication Style</h4>`);
    addHTML(`<div class="result-block" style="border-left-color:${colorMap[style]}; background:${bgMap[style]};"><p><strong>Try this:</strong> ${pack.move}</p></div>`);
// Collapsible "Understanding the Healthiest Communication Style"
addHTML(`
  <div class="result-block" style="border-left-color:${typeColors.Intellectual}; background:${typeOpac.Intellectual};">
    <button id="commHealthyBtn" class="btn" style="max-width:420px;">
      Understanding the Healthiest Communication Style
    </button>
    <div id="commHealthyPanel" class="hidden" style="margin-top:10px;">
      <p>The most successful couples consistently blend two key communication approaches: assertive communication and a collaborative and empathetic spirit. While these may sound like separate skills, they're deeply connected, working together to create a healthy and proactive way to talk.</p>
      <p><strong>Assertive communication</strong> is the tool for expressing yourself. It's about clearly and respectfully stating your needs, feelings, and boundaries without blaming or attacking your partner. Think of it as using "I feel..." statements—you're taking ownership of your emotions, which naturally prevents defensiveness and sets the stage for a productive conversation.</p>
      <p><strong>A collaborative and empathetic spirit</strong> is the tool for connection. It’s about more than just hearing words; it's about actively listening to your partner and trying to understand their perspective. This involves validating their emotions, even if you don't agree with their viewpoint. This approach builds a safe space where both of you can feel vulnerable and understood.</p>
      <p>When you combine these two, they create a powerful and positive cycle. One partner expresses their needs assertively, and the other responds with a collaborative and empathetic heart. This dynamic builds a strong foundation of trust, allowing you to tackle disagreements as a team, not as opponents.</p>
    </div>
  </div>
`);

// Wire the toggle
{
  const healthyBtn = document.getElementById('commHealthyBtn');
  const healthyPanel = document.getElementById('commHealthyPanel');
  healthyBtn?.addEventListener('click', () => {
    healthyPanel?.classList.toggle('hidden');
  });
}

    
const pb = promptsBlockEditable('s4comm', [
      'What is one healthy phrase you will practice using this week?',
      'What support do you need from your spouse to use this style?',
      'Name one moment today to try this approach.'
    ]);
    addHTML(pb.html); wirePromptBlock(pb.id, 's4comm', pb.count);
  });

  // ===============================
  // Thank You
  // ===============================
 safe('thanks', () => {
  addDivider();
  addHTML('<a id="thanks"></a>');
  addHTML(`
    <div class="result-block" style="border-left-color:transparent; background:#fff;">
      <h3 class="thank-title">Thank You</h3>
      <div class="verse">“May the Lord make your love increase and overflow for each other and for everyone else, just as ours does for you.” — 1 Thessalonians 3:12</div>
      <div class="intro-text">
        <p>We hope you had fun diving deep and discovering your unique connection types on multiple levels!</p>
        <p>Remember, this has been a friendly, beginner's assessment, designed not to label you, but to inspire the sparks of connection and help your marriage explore the beautiful, unique individuals within it. Use these insights as a fun tool for introspection and spouse discovery, opening up new conversations and drawing you closer.</p>
        <p>For to be truly known is to unlock the deepest intimacy, empowering you to courageously embrace what's true in your relationship today and boldly aim for what's possible tomorrow—cultivating the lasting love and joy-filled fulfillment God designed for your marriage.</p>
      </div>

      <div class="actions-row">
        <a id="invitePartnerBtn" class="btn" href="#">Invite Your Partner</a>
        <button id="downloadPdfBtn" class="btn">Download PDF</button>
        <a class="btn" href="https://happymarriagehappylife.com" target="_blank" rel="noopener">Site Home</a>
      </div>
    </div>
  `);

  // Download PDF
  const pdfBtn = document.getElementById('downloadPdfBtn');
  if (pdfBtn) pdfBtn.onclick = () => window.print();

  // Invite Your Partner — copy URL and show "linked copy"
  const inviteBtn = document.getElementById('invitePartnerBtn');
  if (inviteBtn) {
    const inviteURL = location.origin + location.pathname;
    inviteBtn.href = inviteURL; // keeps right-click copy behavior

    const copyInviteURL = async () => {
      try {
        await navigator.clipboard.writeText(inviteURL);
        return true;
      } catch (_err) {
        // Fallback for older browsers
        const ta = document.createElement('textarea');
        ta.value = inviteURL;
        ta.setAttribute('readonly', '');
        ta.style.position = 'absolute';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        const ok = document.execCommand && document.execCommand('copy');
        document.body.removeChild(ta);
        return ok;
      }
    };

    inviteBtn.addEventListener('click', async (e) => {
      e.preventDefault(); // don’t navigate
      const prev = inviteBtn.textContent;
      const ok = await copyInviteURL();
      inviteBtn.textContent = ok ? 'linked copy' : 'copy failed';
      setTimeout(() => { inviteBtn.textContent = prev; }, 1400);
    });
  }
});
}

</script>
</body>
</html>
